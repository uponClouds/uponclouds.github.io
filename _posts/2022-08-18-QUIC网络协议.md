---
layout: post
title: QUIC网络协议
categories: 网络
---

QUIC，Quick UDP Internet Connection， 从名字可以看出，是一种基于 UDP 协议实现的应用层网络协议。他的出现主要是为了解决 TCP 协议的一些痛点：

- TCP 建立连接的延迟
- TCP存在队头阻塞问题
- 升级 TCP 的工作很困难
- 基于 TCP 的网络迁移后需要重新建立

QUIC 提高了目前使用 TCP 的面向连接的网络应用的性能。它通过使用用户数据报协议（UDP）在两个端点之间创建若干个多路连接来实现这一目标，其目的是为了在网络层淘汰 TCP，以满足许多应用的需求，因此该协议偶尔也会获得 “TCP/2” 的昵称。QUIC 的协议栈如下：![](https://blogimg-1253107768.cos.ap-guangzhou.myqcloud.com/blogImage/20220810142337.png)

可以看出，QUIC = HTTP/2 + TLS + UDP

## 实现原理

### 数据格式

一个 QUIC 数据包的格式如下：![](https://blogimg-1253107768.cos.ap-guangzhou.myqcloud.com/blogImage/20220810142750.png)

主要由 Header 与 Data 组成，在 Data 中有许多 Frame ，其中 Frame Type 可以有很多种，比如：Stream、ACK、Padding、Window_Update、Blocked 等，传输数据时一般使用的是 Stream 类型，因此我们重点介绍 Stream 帧：![](https://blogimg-1253107768.cos.ap-guangzhou.myqcloud.com/blogImage/20220810143721.png)

一个 Packet 报文中可以存多个这样的 Stream Frame，对于 Stream 类型的帧，我们可以理解为其就是一条 HTTP 请求。

- **Stream ID 作用**：多个并发传输的 HTTP 消息，通过不同的 Stream ID 加以区别，类似于 HTTP2 的 Stream ID；
- **Offset 作用**：类似于 TCP 协议中的 Seq 序号，**保证数据的顺序性和可靠性**；
- **Length 作用**：指明了 Frame 数据的长度。



## 可靠传输

我们知道，TCP 依靠序列号、滑动窗口等机制来保证传输的可靠性，那么 QUIC 为了保证可靠传输也需要实现类似的机制。